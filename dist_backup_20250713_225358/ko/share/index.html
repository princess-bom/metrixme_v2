<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
    <title>Matrix Me - ê²°ê³¼ ê³µìœ </title>
    <meta name="description" content="ë‚˜ì˜ AI í™œìš© ìœ í˜• ì§„ë‹¨ ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ë¡œ ê³µìœ í•˜ì„¸ìš”!">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Matrix Me - AI ìœ í˜• ì§„ë‹¨ ê²°ê³¼">
    <meta property="og:description" content="ë‚˜ì˜ AI í™œìš© ìœ í˜•ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://matrixme.app/ko/share/">
    
    <!-- Keywords -->
    <meta name="keywords" content="AI í…ŒìŠ¤íŠ¸ ê²°ê³¼, AI ì„±í–¥ ì§„ë‹¨ ê²°ê³¼, ê³µìœ , ì´ë¯¸ì§€ ì €ì¥">
    
    <!-- html2canvas CDN -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* í„°ë¯¸ë„ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
            --bg-terminal: #0a0a0a;
            --bg-header: #111111;
            --bg-content: #000000;
            --bg-card: #1a1a1a;
            
            /* ë„¤ì˜¨ ì»¬ëŸ¬ */
            --neon-cyan: #00ccff;
            --neon-blue: #1e90ff;
            --neon-green: #00ff88;
            --neon-yellow: #ffd700;
            --neon-pink: #ff0066;
            --neon-red: #ff3333;
            
            /* í…ìŠ¤íŠ¸ */
            --text-primary: #ffffff;
            --text-secondary: #e6e6fa;
            --text-terminal: #00ff00;
            --text-muted: #888888;
            
            /* í…Œë‘ë¦¬ */
            --border-default: #333333;
            --border-blue: #1e90ff;
            --border-green: #00ff88;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Courier New', monospace;
            background: var(--bg-content);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* ê³µìœ  ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .share-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }

        /* ê³µìœ  ì¹´ë“œ */
        .share-card {
            background: var(--bg-card);
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 
                0 0 20px rgba(30, 144, 255, 0.3),
                0 0 40px rgba(30, 144, 255, 0.1);
        }

        /* ë¡œê³  ì„¹ì…˜ */
        .logo-section {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
            padding-bottom: 20px;
        }

        .logo-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 5px;
            text-shadow: 0 0 10px currentColor;
        }

        .logo-subtitle {
            font-size: 14px;
            color: var(--neon-green);
            text-shadow: 0 0 8px currentColor;
        }

        /* ì‹œìŠ¤í…œ ë©”ì‹œì§€ */
        .system-message {
            font-size: 14px;
            color: var(--neon-pink);
            margin-bottom: 20px;
            text-shadow: 0 0 8px currentColor;
        }

        /* íƒ€ì… ì •ë³´ ì„¹ì…˜ */
        .type-section {
            background: rgba(30, 144, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .type-code {
            font-size: 32px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 8px;
            text-shadow: 0 0 15px currentColor;
        }

        .type-name {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .type-description {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.3;
        }

        /* í†µê³„ ì„¹ì…˜ */
        .stats-section {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
            padding-bottom: 20px;
        }

        .stat-line {
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }

        .stat-line:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: #00FF41;
            font-weight: 700;
            text-shadow: none;
        }

        .stat-value {
            color: var(--neon-green);
            font-weight: 700;
            margin-left: 8px;
            text-shadow: 0 0 8px currentColor;
        }

        .rarity-value {
            color: #FFD700;
            font-weight: 700;
            text-shadow: none;
        }

        /* CTA ì„¹ì…˜ */
        .cta-section {
            font-size: 12px;
            color: var(--text-muted);
        }

        .cta-title {
            margin-bottom: 5px;
        }

        .cta-url {
            color: var(--neon-cyan);
            font-weight: 700;
            text-shadow: 0 0 8px currentColor;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--bg-card);
            border: 2px solid;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-download {
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .btn-download:hover {
            background: var(--neon-green);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .btn-retest {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .btn-retest:hover {
            background: var(--neon-cyan);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.5);
        }

        .btn-result {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }

        .btn-result:hover {
            background: var(--neon-pink);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(255, 0, 102, 0.5);
        }

        .btn-copy {
            border-color: var(--neon-yellow);
            color: var(--neon-yellow);
        }

        .btn-copy:hover {
            background: var(--neon-yellow);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            body {
                padding: max(10px, env(safe-area-inset-top, 10px)) 10px max(10px, env(safe-area-inset-bottom, 10px)) 10px;
            }
            
            .share-card {
                padding: 20px;
            }
            
            .logo-title {
                font-size: 20px;
            }
            
            .type-code {
                font-size: 28px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
                text-align: center;
            }
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
  <script type="module" crossorigin src="../../assets/modulepreload-polyfill-B5Qt9EMX.js"></script>
  <script type="module" crossorigin src="../../assets/result-engine-D2clF4To.js"></script>
</head>
<body>
    <div class="share-container">
        <div id="share-card" class="share-card">
            <!-- ë¡œê³  ì„¹ì…˜ -->
            <div class="logo-section">
                <div class="logo-title">MATRIX ME</div>
                <div class="logo-subtitle">AI DNA Analysis System</div>
            </div>
            
            <!-- ì‹œìŠ¤í…œ ë©”ì‹œì§€ -->
            <div class="system-message">> USER TYPE DETECTED:</div>
            
            <!-- íƒ€ì… ì •ë³´ ì„¹ì…˜ -->
            <div class="type-section">
                <div class="type-code" id="type-code">ë¡œë”© ì¤‘...</div>
                <div class="type-name" id="type-name">ë¡œë”© ì¤‘...</div>
                <div class="type-description" id="type-description">"ë¡œë”© ì¤‘..."</div>
            </div>
            
            <!-- í†µê³„ ì„¹ì…˜ -->
            <div class="stats-section">
                <div class="stat-line">
                    <span class="stat-label">> Neural Match:</span>
                    <span class="stat-value" id="confidence">---%</span>
                    <span class="stat-value">CONFIRMED</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">> í¬ê·€ë„:</span>
                    <span class="rarity-value" id="rarity">ë¡œë”© ì¤‘...</span>
                </div>
            </div>
            
            <!-- CTA ì„¹ì…˜ -->
            <div class="cta-section">
                <div class="cta-title">Discover your AI DNA type</div>
                <div class="cta-url">MATRIXME.APP</div>
            </div>
        </div>
    </div>
    
    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
    <div class="action-buttons">
        <button class="btn btn-download" onclick="downloadAsImage()">
            [ì´ë¯¸ì§€ë¡œ ì €ì¥]
        </button>
        <button class="btn btn-copy" onclick="copyResultLink()">
            [ë§í¬ ë³µì‚¬]
        </button>
        <a href="../result/" class="btn btn-result">
            [ìƒì„¸ ê²°ê³¼ ë³´ê¸°]
        </a>
        <a href="../quiz/" class="btn btn-retest">
            [ë‹¤ì‹œ í…ŒìŠ¤íŠ¸]
        </a>
    </div>

    <!-- Result Engine and Type Definitions -->
    
    <script>
        // ê²°ê³¼ ì—”ì§„ ì¸ìŠ¤í„´ìŠ¤
        let resultEngine = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë”©
        async function loadShareData() {
            try {
                // ResultEngine í´ë˜ìŠ¤ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                if (typeof window.ResultEngine === 'undefined') {
                    await new Promise(resolve => {
                        const checkEngine = () => {
                            if (typeof window.ResultEngine !== 'undefined') {
                                resolve();
                            } else {
                                setTimeout(checkEngine, 100);
                            }
                        };
                        checkEngine();
                    });
                }

                // ê²°ê³¼ ì—”ì§„ ì´ˆê¸°í™”
                resultEngine = new window.ResultEngine();
                
                // í˜„ì¬ URLì—ì„œ ê²°ê³¼ ë°ì´í„° ìƒì„±
                const resultData = await resultEngine.generateCurrentResult();
                
                // ê³µìœ  ì¹´ë“œ ë°ì´í„° ì—…ë°ì´íŠ¸
                updateShareCard(resultData);
                
            } catch (error) {
                console.error('Error loading share data:', error);
                // ì—ëŸ¬ ë°œìƒì‹œ ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById('type-code').textContent = 'ERROR';
                document.getElementById('type-name').textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                document.getElementById('type-description').textContent = '"í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”"';
            }
        }
        
        // ê³µìœ  ì¹´ë“œ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateShareCard(data) {
            // íƒ€ì… ì½”ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('type-code').textContent = data.typeCode;
            
            // íƒ€ì… ì´ë¦„ ì—…ë°ì´íŠ¸ (í’€ë„¤ì„ + í•˜ì´ë¼ì´íŠ¸)
            const typeNameElement = document.getElementById('type-name');
            const fullName = data.fullName || data.typeName.split('(')[1]?.replace(')', '') || 'Unknown';
            
            // ê° ë‹¨ì–´ì˜ ì²« ê¸€ìë¥¼ í•˜ì´ë¼ì´íŠ¸í•˜ì—¬ íƒ€ì… ì½”ë“œ í‘œì‹œ
            const words = fullName.split(/[\s-]+/).filter(word => word.length > 0);
            const firstLetters = words.map(word => word.charAt(0).toUpperCase()).join('');
            const typeCode = data.typeCode || '';
            
            console.log('ğŸ” í•˜ì´ë¼ì´íŠ¸ ì²´í¬:', {
                fullName,
                words,
                firstLetters,
                typeCode,
                wordsLength: words.length,
                match: firstLetters === typeCode
            });
            
            // ì²« ê¸€ìë“¤ì´ íƒ€ì… ì½”ë“œì™€ ì¼ì¹˜í•˜ê³ , ë‹¨ì–´ê°€ 4ê°œì¸ ê²½ìš° í•˜ì´ë¼ì´íŠ¸ ì ìš©
            if (words.length === 4 && firstLetters === typeCode) {
                // ê° ë‹¨ì–´ì˜ ì²« ê¸€ìë¥¼ í•˜ì´ë¼ì´íŠ¸
                const highlightedText = words.map(word => 
                    `<span style="color: #00BFFF; font-weight: bold; font-size: 1.2em;">${word.charAt(0)}</span>${word.slice(1)}`
                ).join(' ');
                typeNameElement.innerHTML = highlightedText;
            } else {
                // íƒ€ì… ì½”ë“œì™€ ì¼ì¹˜í•˜ì§€ ì•Šê±°ë‚˜ ë‹¨ì–´ ìˆ˜ê°€ ë‹¤ë¥´ë©´ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
                typeNameElement.textContent = fullName;
            }
            
            // íƒ€ì… ì„¤ëª… ì—…ë°ì´íŠ¸ (ë”°ì˜´í‘œ ì œê±°)
            let description = data.description || data.typeKorean || data.typeName.split('(')[0].trim();
            if (data.profile && typeof data.profile === 'string') {
                description = data.profile;
            }
            document.getElementById('type-description').textContent = description;
            
            // ì‹ ë¢°ë„ ì—…ë°ì´íŠ¸
            document.getElementById('confidence').textContent = `${data.confidence}%`;
            
            // í¬ê·€ë„ ì—…ë°ì´íŠ¸
            const rarityText = data.rarity || `${data.rarityText}`.replace('> ', '');
            document.getElementById('rarity').textContent = rarityText;
            
            // ìƒì„¸ ê²°ê³¼ ë³´ê¸° ë§í¬ì— URL íŒŒë¼ë¯¸í„° ì¶”ê°€
            const resultLink = document.querySelector('.btn-result');
            if (resultLink && data.typeCode) {
                const currentParams = new URLSearchParams(window.location.search);
                resultLink.href = `../result/?${currentParams.toString()}`;
            }
        }
        
        // ì´ë¯¸ì§€ë¡œ ì €ì¥ ê¸°ëŠ¥
        async function downloadAsImage() {
            try {
                const shareCard = document.getElementById('share-card');
                const canvas = await html2canvas(shareCard, {
                    backgroundColor: '#1a1a1a',
                    scale: 2, // ê³ í•´ìƒë„
                    useCORS: true,
                    allowTaint: true
                });
                
                // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
                const link = document.createElement('a');
                link.download = `matrix-me-${document.getElementById('type-code').textContent.toLowerCase()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
            } catch (error) {
                console.error('Error generating image:', error);
                alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ê²°ê³¼ ë§í¬ ë³µì‚¬ ê¸°ëŠ¥ - Firebase shareId ê¸°ë°˜ í´ë¦° URL ìƒì„±
        async function copyResultLink(event) {
            try {
                let resultUrl;
                
                // sessionStorageì—ì„œ shareId í™•ì¸í•˜ì—¬ í´ë¦° URL ìƒì„±
                const shareId = sessionStorage.getItem('matrixme-shareId');
                
                if (shareId) {
                    // shareIdê°€ ìˆìœ¼ë©´ ì‹¤ì œ í´ë¦° URL ìƒì„±
                    console.log('ğŸ¯ ShareId ë°œê²¬:', shareId);
                    
                    // ì‹¤ì œ í´ë¦° URL ìƒì„± (ë¡œì»¬ì—ì„œë„ ì‘ë™)
                    const baseUrl = window.location.origin;
                    resultUrl = `${baseUrl}/ko/result/${shareId}`;
                    
                    console.log('ğŸ”— í´ë¦° URL ìƒì„±ë¨:', resultUrl);
                } else {
                    // shareIdê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹
                    console.warn('âš ï¸ ShareIdë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©');
                    const currentUrl = window.location.href;
                    resultUrl = currentUrl.replace('/share/', '/result/');
                }
                
                // í´ë¦½ë³´ë“œì— ë³µì‚¬
                await navigator.clipboard.writeText(resultUrl);
                
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì„ì‹œ ë³€ê²½ìœ¼ë¡œ í”¼ë“œë°±
                const button = event ? event.target : document.querySelector('.btn-copy');
                const originalText = button.textContent;
                button.textContent = '[ë³µì‚¬ë¨!]';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
                
            } catch (error) {
                console.error('Error copying link:', error);
                alert('ë§í¬ ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadShareData();
        });
    </script>
</body>
</html>