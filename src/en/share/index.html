<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- üö´ Browser auto-translation completely blocked -->
    <meta name="google" content="notranslate">
    <meta name="robots" content="notranslate">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
    <title>Matrix Me - Share Result</title>
    <meta name="description" content="Share your AI personality test result as an image!">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Matrix Me - AI Personality Result">
    <meta property="og:description" content="My AI personality type has been revealed!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://matrixme.app/en/share/">
    
    <!-- Keywords -->
    <meta name="keywords" content="AI test result, AI personality result, share, image download">
    
    <!-- html2canvas CDN -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* ÌÑ∞ÎØ∏ÎÑê Ïª¨Îü¨ ÌåîÎ†àÌä∏ */
            --bg-terminal: #0a0a0a;
            --bg-header: #111111;
            --bg-content: #000000;
            --bg-card: #1a1a1a;
            
            /* ÎÑ§Ïò® Ïª¨Îü¨ */
            --neon-cyan: #00ccff;
            --neon-blue: #1e90ff;
            --neon-green: #00ff88;
            --neon-yellow: #ffd700;
            --neon-pink: #ff0066;
            --neon-red: #ff3333;
            
            /* ÌÖçÏä§Ìä∏ */
            --text-primary: #ffffff;
            --text-secondary: #e6e6fa;
            --text-terminal: #00ff00;
            --text-muted: #888888;
            
            /* ÌÖåÎëêÎ¶¨ */
            --border-default: #333333;
            --border-blue: #1e90ff;
            --border-green: #00ff88;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Courier New', monospace;
            background: var(--bg-content);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Í≥µÏú† Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà */
        .share-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }

        /* Í≥µÏú† Ïπ¥Îìú */
        .share-card {
            background: var(--bg-card);
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 
                0 0 20px rgba(30, 144, 255, 0.3),
                0 0 40px rgba(30, 144, 255, 0.1);
        }

        /* Î°úÍ≥† ÏÑπÏÖò */
        .logo-section {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
            padding-bottom: 20px;
        }

        .logo-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 5px;
            text-shadow: 0 0 10px currentColor;
        }

        .logo-subtitle {
            font-size: 14px;
            color: var(--neon-green);
            text-shadow: 0 0 8px currentColor;
        }

        /* ÏãúÏä§ÌÖú Î©îÏãúÏßÄ */
        .system-message {
            font-size: 14px;
            color: var(--neon-pink);
            margin-bottom: 20px;
            text-shadow: 0 0 8px currentColor;
        }

        /* ÌÉÄÏûÖ Ï†ïÎ≥¥ ÏÑπÏÖò */
        .type-section {
            background: rgba(30, 144, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .type-code {
            font-size: 32px;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 8px;
            text-shadow: 0 0 15px currentColor;
        }

        .type-name {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .type-description {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.3;
        }

        /* ÌÜµÍ≥Ñ ÏÑπÏÖò */
        .stats-section {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
            padding-bottom: 20px;
        }

        .stat-line {
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }

        .stat-line:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: #00FF41;
            font-weight: 700;
            text-shadow: none;
        }

        .stat-value {
            color: var(--neon-green);
            font-weight: 700;
            margin-left: 8px;
            text-shadow: 0 0 8px currentColor;
        }

        .rarity-value {
            color: #FFD700;
            font-weight: 700;
            text-shadow: none;
        }

        /* CTA ÏÑπÏÖò */
        .cta-section {
            font-size: 12px;
            color: var(--text-muted);
        }

        .cta-title {
            margin-bottom: 5px;
        }

        .cta-url {
            color: var(--neon-cyan);
            font-weight: 700;
            text-shadow: 0 0 8px currentColor;
        }

        /* Ïï°ÏÖò Î≤ÑÌäºÎì§ */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--bg-card);
            border: 2px solid;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-download {
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .btn-download:hover {
            background: var(--neon-green);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .btn-retest {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .btn-retest:hover {
            background: var(--neon-cyan);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.5);
        }

        .btn-result {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }

        .btn-result:hover {
            background: var(--neon-pink);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(255, 0, 102, 0.5);
        }

        .btn-copy {
            border-color: var(--neon-yellow);
            color: var(--neon-yellow);
        }

        .btn-copy:hover {
            background: var(--neon-yellow);
            color: var(--bg-content);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            body {
                padding: max(10px, env(safe-area-inset-top, 10px)) 10px max(10px, env(safe-area-inset-bottom, 10px)) 10px;
            }
            
            .share-card {
                padding: 20px;
            }
            
            .logo-title {
                font-size: 20px;
            }
            
            .type-code {
                font-size: 28px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Î°úÎî© ÏÉÅÌÉú */
        .loading {
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="share-container">
        <div id="share-card" class="share-card">
            <!-- Î°úÍ≥† ÏÑπÏÖò -->
            <div class="logo-section">
                <div class="logo-title">MATRIX ME</div>
                <div class="logo-subtitle">AI DNA Analysis System</div>
            </div>
            
            <!-- ÏãúÏä§ÌÖú Î©îÏãúÏßÄ -->
            <div class="system-message">> USER TYPE DETECTED:</div>
            
            <!-- ÌÉÄÏûÖ Ï†ïÎ≥¥ ÏÑπÏÖò -->
            <div class="type-section">
                <div class="type-code" id="type-code">Loading...</div>
                <div class="type-name" id="type-name">Loading...</div>
                <div class="type-description" id="type-description">"Loading..."</div>
            </div>
            
            <!-- ÌÜµÍ≥Ñ ÏÑπÏÖò -->
            <div class="stats-section">
                <div class="stat-line">
                    <span class="stat-label">> Neural Match:</span>
                    <span class="stat-value" id="confidence">---%</span>
                    <span class="stat-value">CONFIRMED</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">> Rarity:</span>
                    <span class="rarity-value" id="rarity">Loading...</span>
                </div>
            </div>
            
            <!-- CTA ÏÑπÏÖò -->
            <div class="cta-section">
                <div class="cta-title">Discover your AI DNA type</div>
                <div class="cta-url">MATRIXME.APP</div>
            </div>
        </div>
    </div>
    
    <!-- Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
    <div class="action-buttons">
        <button class="btn btn-download" onclick="downloadAsImage()">
            [Download as Image]
        </button>
        <button class="btn btn-copy" onclick="copyResultLink()">
            [Copy Link]
        </button>
        <a href="../result/" class="btn btn-result">
            [View Details]
        </a>
        <a href="../quiz/" class="btn btn-retest">
            [Retake Test]
        </a>
    </div>

    <!-- Result Engine and Type Definitions -->
    <script type="module" src="/assets/data/type-definitions.js"></script>
    <script type="module" src="/assets/js/result-engine.js"></script>
    
    <script>
        // Í≤∞Í≥º ÏóîÏßÑ Ïù∏Ïä§ÌÑ¥Ïä§
        let resultEngine = null;
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎî©
        async function loadShareData() {
            try {
                // ResultEngine ÌÅ¥ÎûòÏä§Í∞Ä Î°úÎìúÎê† ÎïåÍπåÏßÄ ÎåÄÍ∏∞
                if (typeof window.ResultEngine === 'undefined') {
                    await new Promise(resolve => {
                        const checkEngine = () => {
                            if (typeof window.ResultEngine !== 'undefined') {
                                resolve();
                            } else {
                                setTimeout(checkEngine, 100);
                            }
                        };
                        checkEngine();
                    });
                }

                // Í≤∞Í≥º ÏóîÏßÑ Ï¥àÍ∏∞Ìôî
                resultEngine = new window.ResultEngine();
                
                // ÌòÑÏû¨ URLÏóêÏÑú Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                const resultData = await resultEngine.generateCurrentResult();
                
                // Í≥µÏú† Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                updateShareCard(resultData);
                
            } catch (error) {
                console.error('Error loading share data:', error);
                // ÏóêÎü¨ Î∞úÏÉùÏãú Í∏∞Î≥∏ Î©îÏãúÏßÄ ÌëúÏãú
                document.getElementById('type-code').textContent = 'ERROR';
                document.getElementById('type-name').textContent = 'Unable to load data';
                document.getElementById('type-description').textContent = '"Please refresh the page"';
            }
        }
        
        // Í≥µÏú† Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateShareCard(data) {
            // ÌÉÄÏûÖ ÏΩîÎìú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('type-code').textContent = data.typeCode;
            
            // ÌÉÄÏûÖ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ (ÌíÄÎÑ§ÏûÑ + ÌïòÏù¥ÎùºÏù¥Ìä∏)
            const typeNameElement = document.getElementById('type-name');
            const fullName = data.fullName || data.typeName.split('(')[1]?.replace(')', '') || 'Unknown';
            
            // Í∞Å Îã®Ïñ¥Ïùò Ï≤´ Í∏ÄÏûêÎ•º ÌïòÏù¥ÎùºÏù¥Ìä∏ÌïòÏó¨ ÌÉÄÏûÖ ÏΩîÎìú ÌëúÏãú
            const words = fullName.split(/[\s-]+/).filter(word => word.length > 0);
            const firstLetters = words.map(word => word.charAt(0).toUpperCase()).join('');
            const typeCode = data.typeCode || '';
            
            // Ï≤´ Í∏ÄÏûêÎì§Ïù¥ ÌÉÄÏûÖ ÏΩîÎìúÏôÄ ÏùºÏπòÌïòÍ≥†, Îã®Ïñ¥Í∞Ä 4Í∞úÏù∏ Í≤ΩÏö∞ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©
            if (words.length === 4 && firstLetters === typeCode) {
                // Í∞Å Îã®Ïñ¥Ïùò Ï≤´ Í∏ÄÏûêÎ•º ÌïòÏù¥ÎùºÏù¥Ìä∏
                const highlightedText = words.map(word => 
                    `<span style="color: #00BFFF; font-weight: bold; font-size: 1.2em;">${word.charAt(0)}</span>${word.slice(1)}`
                ).join(' ');
                typeNameElement.innerHTML = highlightedText;
            } else {
                // ÌÉÄÏûÖ ÏΩîÎìúÏôÄ ÏùºÏπòÌïòÏßÄ ÏïäÍ±∞ÎÇò Îã®Ïñ¥ ÏàòÍ∞Ä Îã§Î•¥Î©¥ ÏùºÎ∞ò ÌÖçÏä§Ìä∏Î°ú ÌëúÏãú
                typeNameElement.textContent = fullName;
            }
            
            // ÌÉÄÏûÖ ÏÑ§Î™Ö ÏóÖÎç∞Ïù¥Ìä∏ (Îî∞Ïò¥Ìëú Ï†úÍ±∞)
            let description = data.description || data.typeName.split('(')[0].trim();
            if (data.profile && typeof data.profile === 'string') {
                description = data.profile;
            }
            document.getElementById('type-description').textContent = description;
            
            // Ïã†Î¢∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('confidence').textContent = `${data.confidence}%`;
            
            // Ìù¨Í∑ÄÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ (ÏòÅÏñ¥ Ï†ÑÏö©)
            let rarityText = data.rarity || 'Unknown';
            // ÌïúÍµ≠Ïñ¥ Ìù¨Í∑ÄÎèÑ ÌÖçÏä§Ìä∏Î•º ÏòÅÏñ¥Î°ú Î≥ÄÌôò
            if (rarityText.includes('ÏÉÅÏúÑ')) {
                const percentage = rarityText.match(/\d+/)?.[0] || '';
                if (percentage) {
                    rarityText = `Top ${percentage}%`;
                }
            }
            document.getElementById('rarity').textContent = rarityText;
            
            // ÏÉÅÏÑ∏ Í≤∞Í≥º Î≥¥Í∏∞ ÎßÅÌÅ¨Ïóê URL ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä
            const resultLink = document.querySelector('.btn-result');
            if (resultLink && data.typeCode) {
                const currentParams = new URLSearchParams(window.location.search);
                resultLink.href = `../result/?${currentParams.toString()}`;
            }
        }
        
        // Ïù¥ÎØ∏ÏßÄÎ°ú Ï†ÄÏû• Í∏∞Îä•
        async function downloadAsImage() {
            try {
                const shareCard = document.getElementById('share-card');
                const canvas = await html2canvas(shareCard, {
                    backgroundColor: '#1a1a1a',
                    scale: 2, // Í≥†Ìï¥ÏÉÅÎèÑ
                    useCORS: true,
                    allowTaint: true
                });
                
                // Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú
                const link = document.createElement('a');
                link.download = `matrix-me-${document.getElementById('type-code').textContent.toLowerCase()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
            } catch (error) {
                console.error('Error generating image:', error);
                alert('An error occurred while generating the image. Please try again.');
            }
        }

        // Copy result link function - Current URL parameter based stable URL generation
        async function copyResultLink(event) {
            try {
                let resultUrl;
                
                // Use current URL parameters directly for stable link generation
                const currentUrl = window.location.href;
                resultUrl = currentUrl.replace('/share/', '/result/');
                
                console.log('üîó Stable URL generated:', resultUrl);
                
                // ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨
                await navigator.clipboard.writeText(resultUrl);
                
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏ ÏûÑÏãú Î≥ÄÍ≤ΩÏúºÎ°ú ÌîºÎìúÎ∞±
                const button = event ? event.target : document.querySelector('.btn-copy');
                const originalText = button.textContent;
                button.textContent = '[Copied!]';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
                
            } catch (error) {
                console.error('Error copying link:', error);
                alert('An error occurred while copying the link. Please try again.');
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            loadShareData();
        });
    </script>
</body>
</html>