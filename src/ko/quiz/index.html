<!DOCTYPE html>
<html lang="ko" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- ğŸš« ë¸Œë¼ìš°ì € ìë™ ë²ˆì—­ ì™„ì „ ì°¨ë‹¨ -->
    <meta name="google" content="notranslate">
    <meta name="robots" content="notranslate">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Content-Language" content="ko">
    <meta name="language" content="Korean">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
    <title>Matrix Me - AI ìœ í˜• ì§„ë‹¨ í€´ì¦ˆ</title>
    <meta name="description" content="20ê°œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ AI í™œìš© ìœ í˜•ì„ ì§„ë‹¨í•˜ì„¸ìš”! ì¡°ì¢…ì™•, ì–¼ë¦¬ë²„ë“œ, ì™„ì „ì²´ ë“± 16ê°€ì§€ ìœ í˜• ì¤‘ ë‹¹ì‹ ì€?">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Matrix Me - AI ìœ í˜• ì§„ë‹¨ í€´ì¦ˆ">
    <meta property="og:description" content="20ê°œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ AI í™œìš© ìœ í˜•ì„ ì§„ë‹¨í•˜ì„¸ìš”!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://matrixme.app/ko/quiz/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Matrix Me - AI ìœ í˜• ì§„ë‹¨ í€´ì¦ˆ">
    <meta name="twitter:description" content="20ê°œ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ AI í™œìš© ìœ í˜•ì„ ì§„ë‹¨í•˜ì„¸ìš”!">
    
    <!-- Keywords -->
    <meta name="keywords" content="AI í…ŒìŠ¤íŠ¸, AI ì„±í–¥ í…ŒìŠ¤íŠ¸, AI í€´ì¦ˆ, ì¡°ì¢…ì™•, ì–¼ë¦¬ë²„ë“œ, ì™„ì „ì²´, AI í™œìš© ìœ í˜•">
    
    <!-- hreflang íƒœê·¸ -->
    <link rel="alternate" hreflang="ko" href="https://matrixme.app/ko/quiz/">
    <link rel="alternate" hreflang="en" href="https://matrixme.app/en/quiz/">
    <link rel="alternate" hreflang="x-default" href="https://matrixme.app/en/quiz/">
    
    <!-- JSON-LD êµ¬ì¡°í™” ë°ì´í„° -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Quiz",
      "name": "Matrix Me AI í™œìš© ìœ í˜• í…ŒìŠ¤íŠ¸",
      "description": "20ê°œ ì§ˆë¬¸ìœ¼ë¡œ 16ê°€ì§€ AI í™œìš© ì„±í–¥ì„ ì§„ë‹¨í•˜ëŠ” ì¬ë¯¸ìˆëŠ” ì„±ê²© í…ŒìŠ¤íŠ¸",
      "numberOfQuestions": 20,
      "timeRequired": "PT5M",
      "educationalLevel": "ì¼ë°˜ì¸",
      "inLanguage": "ko",
      "hasPart": {
        "@type": "Question",
        "name": "AI í™œìš© ìœ í˜• ì§„ë‹¨ ì§ˆë¬¸"
      },
      "about": {
        "@type": "Thing",
        "name": "AI í™œìš© ì„±í–¥",
        "description": "ê°œì¸ì˜ ì¸ê³µì§€ëŠ¥ ë„êµ¬ ì‚¬ìš© íŒ¨í„´ê³¼ ì„±í–¥"
      }
    }
    </script>
    
    <!-- Critical CSS inline to prevent FOUC -->
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000000 !important;
            color: #00FF00 !important;
            font-family: 'Monaco', 'Menlo', 'Courier New', 'D2Coding', monospace;
            min-height: 100dvh;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        /* ëª¨ë°”ì¼ ì „ì²´í™”ë©´ ì²˜ë¦¬ */
        @media (max-width: 1023px) {
            body {
                padding: 0;
            }
            
            .terminal-container {
                width: 100vw !important;
                max-width: 100vw !important;
                margin: 0 !important;
                border-radius: 0 !important;
            }
        }

        @media (max-width: 767px) {
            body {
                padding: 0 !important;
                margin: 0 !important;
                width: 100vw !important;
                min-height: 100dvh !important;
            }
            
            .terminal-container {
                width: 100vw !important;
                max-width: 100vw !important;
                border-radius: 0 !important;
                min-height: 100dvh !important;
                margin: 0 !important;
                padding-top: env(safe-area-inset-top) !important;
                padding-bottom: env(safe-area-inset-bottom) !important;
            }
        }

        /* body ì •ë ¬ì€ terminal.cssì—ì„œ ê´€ë¦¬ - ì¤‘ë³µ ì œê±° */
            
            .terminal-header {
                padding: 12px 15px;
            }
            
            .terminal-title {
                font-size: 11px;
            }
            
            .terminal-header-buttons {
                display: flex;
                gap: 6px;
            }
            
            .terminal-color-toggle,
            .terminal-language-toggle {
                padding: 4px 8px !important;
                font-size: 10px !important;
                height: 20px !important;
                line-height: 1 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 3px !important;
                box-sizing: border-box !important;
            }
            
            .terminal-content {
                padding: 12px;
                font-size: 12px;
                min-height: auto;
            }
            
            /* ë¡œë”© í™”ë©´ ëª¨ë°”ì¼ ìµœì í™” */
            .boot-sequence {
                padding: 10px 0;
            }
            
            .boot-line {
                font-size: 10px;
                line-height: 1.4;
                margin: 2px 0;
            }
            
            /* í€´ì¦ˆ ì˜µì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            .quiz-option {
                padding: 12px 8px;
                margin: 6px 0;
                font-size: 11px;
            }
            
            .option-letter {
                font-size: 12px;
                min-width: 20px;
            }
            
            /* í€´ì¦ˆ ì§„í–‰ í™”ë©´ ëª¨ë°”ì¼ ìµœì í™” */
            .matrix-input-line {
                flex-direction: row;
                gap: 8px;
                align-items: center;
                justify-content: space-between;
            }
            
            .matrix-input-left {
                flex: 1;
                margin-bottom: 0;
            }
            
            .matrix-input-prompt {
                font-size: 10px;
            }
            
            .matrix-input-text {
                font-size: 11px;
            }
            
            .matrix-next-button, #matrix-next-btn {
                width: 50px !important;
                padding: 6px 8px !important;
                font-size: 11px !important;
                margin-top: 0 !important;
                border-radius: 3px !important;
                flex-shrink: 0;
            }
            
            .matrix-next-button.show, #matrix-next-btn.show {
                display: inline-block !important;
            }
            
            /* ì§„í–‰ë¥  í‘œì‹œ ëª¨ë°”ì¼ ìµœì í™” */
            .matrix-progress-text {
                font-size: 10px;
            }
            
            /* ì§ˆë¬¸ í…ìŠ¤íŠ¸ ëª¨ë°”ì¼ ìµœì í™” */
            #question-text {
                font-size: 12px;
                line-height: 1.5;
                margin-bottom: 15px;
            }
            
            /* ë‹µë³€ ì˜µì…˜ ì»¨í…Œì´ë„ˆ ëª¨ë°”ì¼ ìµœì í™” */
            #answer-options {
                gap: 8px;
            }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: -1;
        }
        
        /* í„°ë¯¸ë„ ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (CSS íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•Šì„ ê²½ìš° ëŒ€ë¹„) */
        .terminal-container {
            width: 100%;
            max-width: 900px;
            background: #1A1A1A;
            border-radius: 12px;
            box-shadow: 
                0 0 20px rgba(0, 255, 0, 0.3),
                0 0 40px rgba(0, 255, 0, 0.1),
                0 0 80px rgba(0, 255, 0, 0.05);
            overflow: hidden;
            position: relative;
        }
        
        .terminal-header {
            background: #0A0A0A;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #333;
        }
        
        .terminal-controls {
            display: flex;
            gap: 8px;
        }
        
        .control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .control.red { background: #FF5F57; }
        .control.yellow { background: #FFBD2E; }
        .control.green { background: #28CA42; }
        
        .terminal-title {
            color: #00CCFF;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 0 10px currentColor;
        }
        
        .terminal-content {
            padding: 20px;
            min-height: 500px;
            font-size: 14px;
            line-height: 1.6;
            background: #000000;
        }

        .terminal-language-toggle {
            background: transparent !important;
            border: 1px solid #00CCFF !important;
            color: #00CCFF !important;
            padding: 4px 8px !important;
            border-radius: 3px !important;
            font-family: inherit !important;
            font-size: 10px !important;
            font-weight: bold !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            opacity: 1 !important;
            text-shadow: 0 0 8px #00CCFF !important;
        }

        .terminal-language-toggle::before,
        .terminal-language-toggle::after {
            content: none !important;
        }

        .terminal-language-toggle:hover {
            background: #00CCFF !important;
            color: #000 !important;
            transform: none !important;
            box-shadow: none !important;
        }

        .terminal-color-toggle {
            background: transparent !important;
            border: 1px solid #00CCFF !important;
            color: #00CCFF !important;
            padding: 4px 8px !important;
            border-radius: 3px !important;
            font-family: inherit !important;
            font-size: 10px !important;
            font-weight: bold !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            opacity: 1 !important;
            text-shadow: 0 0 8px #00CCFF !important;
        }

        .terminal-color-toggle::before,
        .terminal-color-toggle::after {
            content: none !important;
        }

        .terminal-color-toggle:hover {
            background: #00CCFF !important;
            color: #000 !important;
            transform: none !important;
            box-shadow: none !important;
        }
    </style>
    
    <link rel="stylesheet" href="/assets/css/terminal.css">
    <link rel="stylesheet" href="/assets/css/mobile.css">
    <link rel="stylesheet" href="/assets/css/scroll-optimization.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-controls">
                <span class="control red"></span>
                <span class="control yellow"></span>
                <span class="control green"></span>
            </div>
            <div class="terminal-title">
                <span class="title-part1">MATRIX ME</span>
                <span class="title-separator"> - </span>
                <span class="title-part2">DNA Scanner Active</span>
            </div>
            <div class="terminal-header-buttons">
                <button class="terminal-color-toggle" id="ko-quiz-color-toggle">
                    C
                </button>
                <button class="terminal-language-toggle" id="ko-quiz-language-toggle">
                    EN
                </button>
            </div>
        </div>
        
        <div class="terminal-content" id="terminal">
            <!-- ë¡œë”© í™”ë©´ -->
            <div id="loading-screen">
                <div class="boot-sequence">
                    <div class="boot-line">Matrix Me Terminal v2.1.0</div>
                    <div class="boot-line">Copyright (c) 2025 Matrix Me Project</div>
                    <div class="boot-line">All rights reserved.</div>
                    <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                    <div class="boot-line"></div>
                    <div class="boot-line">AI DNA ìŠ¤ìº” ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
                    <div class="boot-line">ï¼»<span id="main-loading-progress">â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘</span>ï¼½ <span id="main-progress-percent">0</span>%</div>
                    <div class="boot-line"></div>
                    <div class="boot-line" id="main-completion-text" style="display: none;">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ.</div>
                </div>
            </div>

            <!-- í€´ì¦ˆ ì‹œì‘ í™”ë©´ -->
            <div id="quiz-start" style="display: none;">
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line quiz-title">Matrix Me - AI ìœ í˜• ì§„ë‹¨ í€´ì¦ˆ</div>
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line"></div>
                <div class="boot-line">ë‹¹ì‹ ì˜ AI í™œìš© ìœ í˜•ì„ 16ê°€ì§€ ì¤‘ì—ì„œ ì •í™•íˆ ì§„ë‹¨í•©ë‹ˆë‹¤.</div>
                <div class="boot-line">20ê°œì˜ ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ì£¼ì„¸ìš”.</div>
                <div class="boot-line"></div>
                <div class="boot-line"></div>
                <div class="boot-line">â±ï¸ ì˜ˆìƒ ì†Œìš” ì‹œê°„: 3-5ë¶„</div>
                <div class="boot-line">ğŸ¯ ì •í™•ë„: 95%</div>
                <div class="boot-line"></div>
                <div class="boot-line">ì¤€ë¹„ë˜ì…¨ë‚˜ìš”?</div>
                <div class="boot-line"></div>
                <div class="quiz-options">
                    <div class="quiz-option" data-action="start">
                        <span class="option-letter">Enter</span>
                        <span class="option-content">ì§„ë‹¨ ì‹œì‘í•˜ê¸°</span>
                    </div>
                    <div class="quiz-option" data-action="back">
                        <span class="option-letter">ESC</span>
                        <span class="option-content">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                    </div>
                </div>
                <div class="boot-line"></div>
                <div class="input-line">
                    <span class="prompt">root@matrix-me:~$ </span>
                    <span class="input-text" id="start-input"></span>
                    <span class="cursor">_</span>
                </div>
            </div>

            <!-- í€´ì¦ˆ ì§„í–‰ í™”ë©´ -->
            <div id="quiz-progress" style="display: none;">
                <div class="boot-line">
                    <span>&gt; MATRIX ME AI DNA scan initiated...</span>
                </div>
                <div class="matrix-progress-section">
                    <div class="matrix-progress-bar">
                        <span class="matrix-progress-text">Matrix Progress:</span>
                        <div class="matrix-progress-fill" id="matrix-progress-fill"></div>
                        <span class="matrix-progress-text" id="matrix-progress-text">80% [16/20]</span>
                    </div>
                </div>
                <div class="boot-line">&gt; Analyzing neural patterns...</div>
                <div class="boot-line">&gt;</div>
                
                <div class="matrix-question-box">
                    <div class="matrix-question-header">
                        MATRIX QUERY #<span id="question-number">16</span>: â—â—â—
                    </div>
                    <div class="matrix-question-text" id="question-text">
                        ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
                
                <div class="quiz-options" id="answer-options">
                    <!-- ë‹µë³€ ì˜µì…˜ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="matrix-input-section">
                    <div class="matrix-input-line">
                        <div class="matrix-input-left">
                            <span class="matrix-input-prompt">&gt; Matrix input:</span>
                            <span class="matrix-input-text" id="matrix-input-text">_</span>
                        </div>
                        <button class="matrix-next-button" id="matrix-next-btn" disabled>ë‹¤ìŒ</button>
                    </div>
                </div>
            </div>

            <!-- ê²°ê³¼ ë¶„ì„ í™”ë©´ -->
            <div id="quiz-analyzing" style="display: none;">
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line neon-strong">AI DNA ë¶„ì„ ì§„í–‰ ì¤‘...</div>
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line"></div>
                <div class="boot-line">â–¶ ë‹µë³€ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ...</div>
                <div class="boot-line">â–¶ í–‰ë™ íŒ¨í„´ ë¶„ì„ ì¤‘...</div>
                <div class="boot-line">â–¶ AI í™œìš© ì„±í–¥ ê³„ì‚° ì¤‘...</div>
                <div class="boot-line">â–¶ 16ê°œ ìœ í˜• ì¤‘ ë§¤ì¹­ ì§„í–‰...</div>
                <div class="boot-line">â–¶ ì •í™•ë„ ê²€ì¦ ì¤‘...</div>
                <div class="boot-line"></div>
                <div class="boot-line">ë¶„ì„ ì§„í–‰ë¥ :</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="analysis-progress" style="width: 0%"></div>
                    <div class="progress-text" id="analysis-text">0%</div>
                </div>
                <div class="boot-line"></div>
                <div class="boot-line">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
                <div class="boot-line"></div>
                <div class="loading">
                    <div class="cursor">_</div>
                </div>
            </div>

            <!-- ì—ëŸ¬ í™”ë©´ -->
            <div id="error-screen" style="display: none;">
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line text-error neon-strong">ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ</div>
                <div class="boot-line separator-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>
                <div class="boot-line"></div>
                <div class="boot-line text-error">ì˜¤ë¥˜: <span id="error-message">ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span></div>
                <div class="boot-line"></div>
                <div class="boot-line">ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:</div>
                <div class="boot-line"></div>
                <div class="quiz-options">
                    <div class="quiz-option" data-action="retry">
                        <span class="option-letter">R</span>
                        <span class="option-content">ë‹¤ì‹œ ì‹œë„</span>
                    </div>
                    <div class="quiz-option" data-action="home">
                        <span class="option-letter">H</span>
                        <span class="option-content">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                    </div>
                </div>
                <div class="boot-line"></div>
                <div class="input-line">
                    <span class="prompt">root@matrix-me:~$ </span>
                    <span class="input-text" id="error-input"></span>
                    <span class="cursor">_</span>
                </div>
            </div>
        </div>
        
    </div>

    <!-- í€´ì¦ˆ í˜ì´ì§€ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ ë¹„í™œì„±í™” -->
    <script type="module" src="../../assets/js/terminal.js"></script>
    <script type="module" src="../../assets/js/typing.js"></script>
    <script type="module" src="../../assets/js/responsive-separator.js"></script>
    <script type="module" src="../../assets/js/smooth-scroll-handler.js"></script>
    
    <!-- Firebase ì„œë¹„ìŠ¤ -->
    <script type="module" src="../../assets/js/firebase-service.js"></script>
    
    <!-- ìƒˆë¡œìš´ 4ì¶• ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ë“¤ -->
    <script type="module" src="../../assets/js/four-axis-engine.js"></script>
    <script type="module" src="../../assets/js/korean-type-mapping.js"></script>
    <script type="module" src="../../assets/js/quiz-state-manager.js"></script>
    <script type="module" src="../../assets/js/unified-quiz-controller.js"></script>
    
    <!-- ê¸°ì¡´ í€´ì¦ˆ ì—”ì§„ (í•˜ìœ„ í˜¸í™˜ì„±) -->
    <script type="module" src="../../assets/js/quiz.js"></script>
    <script>
        // ì „ë¬¸ê°€ ì¡°ì–¸: ë¸Œë¼ìš°ì €ë³„ íŠ¹ìˆ˜ ì²˜ë¦¬
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/KAKAOTALK/i.test(userAgent)) {
            document.body.classList.add('is-kakaotalk-webview');
            console.log('KakaoTalk WebView detected');
        }

        // ì „ë¬¸ê°€ ì¡°ì–¸: JavaScript ê¸°ë°˜ ë™ì  ë†’ì´ ì¡°ì • (100dvh í´ë°±)
        function forceFullscreenHeight() {
            // ì‹¤ì œ ë·°í¬íŠ¸ ë†’ì´ (ì£¼ì†Œì°½, í•˜ë‹¨ë°” ë“± ì œì™¸ëœ ìˆœìˆ˜ ê°€ì‹œ ì˜ì—­)
            const actualVh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${actualVh}px`);
            console.log('Dynamic height adjusted:', actualVh * 100 + 'px', 'innerHeight:', window.innerHeight);
        }

        // ì´ˆê¸° ë¡œë“œ ì‹œ í•œ ë²ˆ ì‹¤í–‰
        forceFullscreenHeight();
        // ë·°í¬íŠ¸ í¬ê¸° ë³€ê²½ ì‹œ (ê°€ë¡œ/ì„¸ë¡œ ì „í™˜, ë¸Œë¼ìš°ì € UI ë³€ê²½) ë‹¤ì‹œ ì‹¤í–‰
        window.addEventListener('resize', forceFullscreenHeight);
        // iOSì—ì„œ ì£¼ì†Œì°½ì´ ìˆ¨ê²¨ì§€ê±°ë‚˜ ë‚˜íƒ€ë‚  ë•Œ ë°œìƒí•˜ëŠ” 'resize' ì´ë²¤íŠ¸ì— ë°˜ì‘
        window.addEventListener('orientationchange', forceFullscreenHeight);

        document.addEventListener('DOMContentLoaded', function() {
            // ì»¬ëŸ¬ í…Œë§ˆ ê´€ë¦¬ ê°ì²´
            const ColorManager = {
                themes: [
                    { name: 'ë¯¼íŠ¸ ê·¸ë¦°', color: '#00CC88' },
                    { name: 'ì‹¤ë²„ í™”ì´íŠ¸', color: '#D0D0D0' },
                    { name: 'ì•°ë²„ ì˜¤ë Œì§€', color: '#FF8C00' },
                    { name: 'ë„¤ì˜¨ í•‘í¬', color: '#FF0080' },
                    { name: 'ì•„ì´ìŠ¤ ë¸”ë£¨', color: '#00AAFF' }
                ],
                currentIndex: 0,
                
                init() {
                    this.applyColor(this.themes[0].color);
                },
                
                toggleColor() {
                    this.currentIndex = (this.currentIndex + 1) % this.themes.length;
                    const currentTheme = this.themes[this.currentIndex];
                    this.applyColor(currentTheme.color);
                },
                
                applyColor(color) {
                    // RGB ë³€í™˜ í•¨ìˆ˜
                    const hexToRgb = (hex) => {
                        const r = parseInt(hex.slice(1, 3), 16);
                        const g = parseInt(hex.slice(3, 5), 16);
                        const b = parseInt(hex.slice(5, 7), 16);
                        return `${r}, ${g}, ${b}`;
                    };
                    
                    const rgbColor = hexToRgb(color);
                    
                    // CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                    document.documentElement.style.setProperty('--text-primary', color);
                    document.documentElement.style.setProperty('--text-success', color);
                    document.documentElement.style.setProperty('--text-secondary', color);
                    document.documentElement.style.setProperty('--text-primary-rgb', rgbColor);
                    
                    // í„°ë¯¸ë„ ì»¨í…Œì´ë„ˆ ë°°ê²½ ë„¤ì˜¨ íš¨ê³¼ ì—…ë°ì´íŠ¸
                    const terminalContainer = document.querySelector('.terminal-container');
                    if (terminalContainer) {
                        terminalContainer.style.boxShadow = `
                            0 0 20px rgba(${rgbColor}, 0.3),
                            0 0 40px rgba(${rgbColor}, 0.1),
                            0 0 80px rgba(${rgbColor}, 0.05)
                        `;
                    }
                    
                    // ì»¬ëŸ¬ í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const colorTogglesCustom = document.querySelectorAll('.terminal-color-toggle');
                    colorTogglesCustom.forEach(toggle => {
                        toggle.style.color = color;
                        toggle.style.borderColor = color;
                        toggle.style.textShadow = `0 0 8px ${color}`;
                    });
                    
                    // ì–¸ì–´ í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const languageToggles = document.querySelectorAll('.terminal-language-toggle');
                    languageToggles.forEach(toggle => {
                        toggle.style.color = color;
                        toggle.style.borderColor = color;
                        toggle.style.textShadow = `0 0 8px ${color}`;
                    });
                    
                    // ì»¬ëŸ¬ í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ (í€´ì¦ˆ ì§„í–‰ í™”ë©´ìš©)
                    const colorToggles = document.querySelectorAll('.terminal-color-toggle');
                    colorToggles.forEach(toggle => {
                        toggle.style.color = color;
                        toggle.style.borderColor = color;
                        toggle.style.textShadow = `0 0 8px ${color}`;
                    });
                    
                    // í”„ë¡œê·¸ë˜ìŠ¤ ë°” ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const progressElements = document.querySelectorAll('#loading-progress, #analysis-progress, .matrix-progress-fill');
                    progressElements.forEach(element => {
                        if (element) {
                            element.style.color = color;
                            element.style.backgroundColor = color;
                            element.style.textShadow = `0 0 10px ${color}`;
                        }
                    });
                    
                    // í”„ë¡œê·¸ë˜ìŠ¤ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const progressTexts = document.querySelectorAll('.matrix-progress-text, #analysis-text');
                    progressTexts.forEach(text => {
                        if (text) {
                            text.style.color = color;
                            text.style.textShadow = `0 0 8px ${color}`;
                        }
                    });
                    
                    // ë¡œë”© í™”ë©´ ìš”ì†Œë“¤ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const loadingElements = document.querySelectorAll('#loading-progress, #progress-percent, #completion-text, #loading-text');
                    loadingElements.forEach(element => {
                        if (element) {
                            element.style.color = color;
                            element.style.textShadow = `0 0 10px ${color}`;
                        }
                    });
                    
                    // ë¡œë”© í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const loadingText = document.getElementById('loading-text');
                    if (loadingText) {
                        loadingText.style.color = color;
                        loadingText.style.textShadow = `0 0 10px ${color}`;
                    }
                    
                    // ì™„ë£Œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const completionText = document.getElementById('completion-text');
                    if (completionText) {
                        completionText.style.color = color;
                        completionText.style.textShadow = `0 0 15px ${color}`;
                    }
                    
                    // 1. í•œì˜ í† ê¸€í‚¤ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const languageToggle = document.getElementById('language-toggle');
                    if (languageToggle) {
                        languageToggle.style.color = color;
                        languageToggle.style.borderColor = color;
                        languageToggle.style.textShadow = `0 0 8px ${color}`;
                    }
                    
                    // 4. ë„¤ì˜¨ íš¨ê³¼ ì œê±°ëœ ë²„ì „ì˜ ì œëª© ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const quizTitle = document.querySelector('.quiz-title');
                    if (quizTitle) {
                        quizTitle.style.color = color;
                        quizTitle.style.textShadow = `0 0 5px ${color}`;
                    }
                    
                    const neonStrong = document.querySelectorAll('.neon-strong');
                    neonStrong.forEach(element => {
                        if (element) {
                            element.style.color = color;
                            element.style.textShadow = `0 0 5px ${color}`;
                        }
                    });
                    
                    // 5. Matrix Input ìš”ì†Œë“¤ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const matrixInputElements = document.querySelectorAll('.matrix-input-prompt, .matrix-input-text, #matrix-input-text');
                    matrixInputElements.forEach(element => {
                        if (element) {
                            element.style.color = color;
                            element.style.textShadow = `0 0 8px ${color}`;
                        }
                    });
                    
                    // 6. ë‹¤ìŒ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const nextButtons = document.querySelectorAll('#matrix-next-btn, .matrix-next-button');
                    nextButtons.forEach(nextButton => {
                        if (nextButton) {
                            nextButton.style.setProperty('color', color, 'important');
                            nextButton.style.setProperty('border-color', color, 'important');
                            nextButton.style.setProperty('text-shadow', `0 0 8px ${color}`, 'important');
                        }
                    });
                    
                    // ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë‹¤ìŒ ë²„íŠ¼ì„ ìœ„í•œ CSS ìŠ¤íƒ€ì¼
                    const nextButtonStyle = document.createElement('style');
                    nextButtonStyle.textContent = `
                        .matrix-next-button, #matrix-next-btn {
                            color: ${color} !important;
                            border-color: ${color} !important;
                            text-shadow: 0 0 8px ${color} !important;
                        }
                        .matrix-next-button.show, #matrix-next-btn.show {
                            display: inline-block !important;
                        }
                    `;
                    
                    // ê¸°ì¡´ ë‹¤ìŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì œê±° í›„ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì¶”ê°€
                    const existingNextStyle = document.getElementById('dynamic-next-button-styles');
                    if (existingNextStyle) {
                        existingNextStyle.remove();
                    }
                    nextButtonStyle.id = 'dynamic-next-button-styles';
                    document.head.appendChild(nextButtonStyle);
                    
                    // 7. í€´ì¦ˆ ì˜µì…˜ ë³´ê¸° ìƒ‰ìƒ ì—…ë°ì´íŠ¸ (ë„¤ì˜¨ íš¨ê³¼ ì œê±°)
                    const quizOptions = document.querySelectorAll('.quiz-option');
                    quizOptions.forEach(option => {
                        if (option) {
                            option.style.color = color;
                            option.style.textShadow = 'none';
                            option.style.borderColor = color;
                        }
                    });
                    
                    // 8. ì„ íƒëœ ë³´ê¸° ì²´í¬ í‘œì‹œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const selectedOptions = document.querySelectorAll('.quiz-option.selected');
                    selectedOptions.forEach(option => {
                        if (option) {
                            option.style.backgroundColor = `rgba(${rgbColor}, 0.1)`;
                            option.style.color = color;
                            option.style.borderColor = color;
                        }
                    });
                    
                    // 9. ë³´ê¸° í˜¸ë²„ íš¨ê³¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    const style = document.createElement('style');
                    style.textContent = `
                        .quiz-option:hover {
                            background-color: rgba(${rgbColor}, 0.05) !important;
                            color: ${color} !important;
                            border-color: ${color} !important;
                            text-shadow: none !important;
                        }
                        .quiz-option.selected {
                            background-color: rgba(${rgbColor}, 0.1) !important;
                            color: ${color} !important;
                            border-color: ${color} !important;
                            text-shadow: none !important;
                        }
                    `;
                    
                    // ê¸°ì¡´ ìŠ¤íƒ€ì¼ íƒœê·¸ ì œê±° í›„ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì¶”ê°€
                    const existingStyle = document.getElementById('dynamic-quiz-styles');
                    if (existingStyle) {
                        existingStyle.remove();
                    }
                    style.id = 'dynamic-quiz-styles';
                    document.head.appendChild(style);
                    
                    // 7. ë‹µë³€ ì €ì¥ ì¤‘ ë©”ì‹œì§€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸ (displayQuestionì—ì„œ ì—…ë°ì´íŠ¸ë¨)
                    // ì´ë¯¸ matrix-input-textì—ì„œ ì²˜ë¦¬ë¨
                }
            };
            
            // === ìƒˆë¡œìš´ 4ì¶• ì‹œìŠ¤í…œ ì´ˆê¸°í™” ===
            // ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë¡œë“œë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸° (ëª¨ë“ˆ ë¡œë”© ì‹œê°„ ê³ ë ¤)
            let componentCheckAttempts = 0;
            const maxAttempts = 50; // 5ì´ˆ ìµœëŒ€ ëŒ€ê¸°
            
            function waitForComponents() {
                componentCheckAttempts++;
                
                if (window.UnifiedQuizController && window.FourAxisEngine && window.KoreanTypeMapping && window.QuizStateManager) {
                    console.log('ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë¡œë“œ ì™„ë£Œ, 4ì¶• ì‹œìŠ¤í…œìœ¼ë¡œ ì´ˆê¸°í™”');
                    // ìƒˆë¡œìš´ í†µí•© ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ìš©
                    window.quizApp = new UnifiedQuizController('ko');
                    window.quizApp.initialize().catch(error => {
                        console.error('4ì¶• ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨, ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œ fallback:', error);
                        initializeLegacyQuiz();
                    });
                } else if (componentCheckAttempts >= maxAttempts) {
                    console.warn('ì»´í¬ë„ŒíŠ¸ ë¡œë”© íƒ€ì„ì•„ì›ƒ, ê¸°ì¡´ ì‹œìŠ¤í…œìœ¼ë¡œ fallback');
                    initializeLegacyQuiz();
                } else {
                    console.log(`ì»´í¬ë„ŒíŠ¸ ë¡œë”© ì¤‘... (${componentCheckAttempts}/${maxAttempts})`, {
                        UnifiedQuizController: !!window.UnifiedQuizController,
                        FourAxisEngine: !!window.FourAxisEngine,
                        KoreanTypeMapping: !!window.KoreanTypeMapping,
                        QuizStateManager: !!window.QuizStateManager
                    });
                    // ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ 100ms í›„ ë‹¤ì‹œ ì²´í¬
                    setTimeout(waitForComponents, 100);
                }
            }
            
            // 4ì¶• ì‹œìŠ¤í…œ ìš°ì„  ì‹œë„
            waitForComponents();
            
            // ê¸°ì¡´ ì‹œìŠ¤í…œ ì´ˆê¸°í™” í•¨ìˆ˜ (fallback)
            function initializeLegacyQuiz() {
                if (window.KoreanQuizApp) {
                    window.quizApp = new KoreanQuizApp();
                    
                    // URL íŒŒë¼ë¯¸í„°ë¡œ ìƒíƒœ ë³µì› í™•ì¸
                    const urlParams = new URLSearchParams(window.location.search);
                    const questionIndex = urlParams.get('q');
                    const answers = urlParams.get('a');
                    
                    if (questionIndex !== null && answers !== null) {
                        // ë¨¼ì € ì •ìƒ ì´ˆê¸°í™” í›„ ìƒíƒœ ë³µì›
                        window.quizApp.initialize().then(() => {
                            return window.quizApp.restoreFromUrl(parseInt(questionIndex), answers.split(','));
                        }).then(() => {
                            // URL íŒŒë¼ë¯¸í„° ì œê±° (ìƒˆë¡œê³ ì¹¨ ì‹œ ì •ìƒ ì‹œì‘ë˜ë„ë¡)
                            window.history.replaceState(null, '', window.location.pathname);
                        }).catch(error => {
                            console.error('Restore failed, falling back to normal init:', error);
                            window.quizApp.initialize();
                        });
                    } else {
                        window.quizApp.initialize();
                    }
                }
            }
            
            // ì»¬ëŸ¬ ë§¤ë‹ˆì € ì´ˆê¸°í™”
            ColorManager.init();
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìƒ‰ìƒ ìƒíƒœ ë³µì›
            const savedColorIndex = localStorage.getItem('matrixme-color-index');
            if (savedColorIndex !== null) {
                ColorManager.currentIndex = parseInt(savedColorIndex);
                ColorManager.applyColor(ColorManager.themes[ColorManager.currentIndex].color);
            }
            
            // ì»¬ëŸ¬ í† ê¸€ ë²„íŠ¼ ê¸°ëŠ¥
            document.getElementById('ko-quiz-color-toggle').addEventListener('click', () => {
                ColorManager.toggleColor();
                localStorage.setItem('matrixme-color-index', ColorManager.currentIndex);
            });
            
            // === ê°œì„ ëœ ì–¸ì–´ í† ê¸€ ê¸°ëŠ¥ ===
            function toggleLanguage() {
                if (window.quizApp && typeof window.quizApp.generateLanguageToggleUrl === 'function') {
                    // ìƒˆë¡œìš´ 4ì¶• ì‹œìŠ¤í…œì˜ ìƒíƒœ ê´€ë¦¬ì ì‚¬ìš©
                    const newUrl = window.quizApp.generateLanguageToggleUrl();
                    window.location.href = newUrl;
                } else {
                    // ê¸°ì¡´ ì‹œìŠ¤í…œ fallback
                    let newUrl = window.location.pathname.replace('/ko/', '/en/');
                    
                    // í€´ì¦ˆ ì§„í–‰ ì¤‘ì´ë©´ í˜„ì¬ ìƒíƒœë¥¼ URLì— í¬í•¨
                    if (typeof window.quizApp !== 'undefined' && window.quizApp.quizEngine && window.quizApp.quizEngine.isStarted) {
                        const currentQ = window.quizApp.quizEngine.currentQuestion;
                        const currentAnswers = window.quizApp.quizEngine.answers || [];
                        
                        // ë‹µì•ˆ ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜
                        const answerStrings = currentAnswers.map(answer => {
                            if (typeof answer === 'object') {
                                return answer.letter || answer.value || 'a';
                            }
                            return answer.toString();
                        });
                        
                        if (currentQ !== undefined && answerStrings.length > 0) {
                            const params = new URLSearchParams();
                            params.set('q', currentQ.toString());
                            params.set('a', answerStrings.join(','));
                            newUrl += '?' + params.toString();
                        }
                    }
                    
                    window.location.href = newUrl;
                }
            }
            
            // ì–¸ì–´ í† ê¸€ ë²„íŠ¼ ì—°ê²°
            const languageToggleBtn = document.getElementById('ko-quiz-language-toggle');
            languageToggleBtn.addEventListener('click', toggleLanguage);
            
            // í€´ì¦ˆ ì§„í–‰ í™”ë©´ì˜ ì»¬ëŸ¬ í† ê¸€ ê¸°ëŠ¥ (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
            const quizColorToggle = document.getElementById('quiz-color-toggle');
            if (quizColorToggle) {
                quizColorToggle.addEventListener('click', () => {
                    ColorManager.toggleColor();
                    localStorage.setItem('matrixme-color-index', ColorManager.currentIndex);
                });
            }
            
            
        });

        class KoreanQuizApp {
            constructor() {
                this.quizEngine = new QuizEngine('ko');
                this.terminal = new TerminalEngine(document.getElementById('terminal'));
                this.typing = new TypingEngine();
                this.currentScreen = 'loading';
                this.selectedAnswer = null;
                this.isProcessing = false;
                this.keydownHandler = null;
                this.clickHandler = null;
            }

            async initialize() {
                try {
                    await this.quizEngine.loadQuizData();
                    
                    // ì–¸ì–´ í† ê¸€ë¡œ ì˜¨ ê²½ìš° ìƒíƒœ ë³µì›
                    if (sessionStorage.getItem('languageToggle') === 'true') {
                        await this.showLoadingScreen(true); // ìƒíƒœ ë³µì› ëª¨ë“œ
                        await this.restoreQuizState();
                    } else {
                        await this.showLoadingScreen(false); // ì¼ë°˜ ëª¨ë“œ
                    }
                } catch (error) {
                    console.error('Initialization error:', error);
                    this.showErrorScreen('í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            async showLoadingScreen(isRestoreMode = false) {
                this.currentScreen = 'loading';
                document.getElementById('loading-screen').style.display = 'block';
                
                // ë‹¤ë¥¸ í™”ë©´ ìˆ¨ê¸°ê¸°
                document.getElementById('quiz-start').style.display = 'none';
                document.getElementById('quiz-progress').style.display = 'none';
                document.getElementById('quiz-analyzing').style.display = 'none';
                document.getElementById('error-screen').style.display = 'none';
                
                // ë©”ì¸ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                await this.animateMainLoading();
                
                // ìƒíƒœ ë³µì› ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ í€´ì¦ˆ ì‹œì‘ í™”ë©´ìœ¼ë¡œ ì´ë™
                if (!isRestoreMode) {
                    await this.showStartScreen();
                }
            }

            async animateMainLoading() {
                const progressElement = document.getElementById('main-loading-progress');
                const percentElement = document.getElementById('main-progress-percent');
                const completionText = document.getElementById('main-completion-text');
                
                const steps = [
                    { progress: 'â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘', percent: 0, delay: 0 },
                    { progress: 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘', percent: 20, delay: 500 },
                    { progress: 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘', percent: 40, delay: 1000 },
                    { progress: 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘', percent: 60, delay: 1500 },
                    { progress: 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘', percent: 80, delay: 2000 },
                    { progress: 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', percent: 100, delay: 2500 }
                ];
                
                for (const step of steps) {
                    await this.sleep(step.delay === 0 ? 300 : 800);
                    progressElement.textContent = step.progress;
                    percentElement.textContent = step.percent;
                }
                
                // 100% ì™„ë£Œ í›„ 1ì´ˆ ë’¤ì— ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
                await this.sleep(1000);
                completionText.style.display = 'block';
                
                // ì¶”ê°€ 1ì´ˆ ëŒ€ê¸°
                await this.sleep(1000);
            }

            async showStartScreen() {
                this.currentScreen = 'start';
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('quiz-start').style.display = 'block';
                
                this.setupEventListeners();
            }

            async showQuizScreen() {
                this.currentScreen = 'quiz';
                document.getElementById('quiz-start').style.display = 'none';
                document.getElementById('quiz-progress').style.display = 'block';
                
                this.quizEngine.startQuiz();
                this.quizEngine.isStarted = true; // ì´ê²ƒì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤!
                await this.displayQuestion();
                this.setupEventListeners();
            }

            async displayQuestion() {
                const question = this.quizEngine.getCurrentQuestion();
                if (!question) {
                    await this.showAnalyzing();
                    return;
                }

                const progress = this.quizEngine.getProgress();
                
                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                document.getElementById('question-number').textContent = progress.current + 1;
                document.getElementById('matrix-progress-text').textContent = `${progress.percentage}% [${progress.current + 1}/${progress.total}]`;
                document.getElementById('matrix-progress-fill').style.setProperty('--progress-width', `${progress.percentage}%`);
                
                // ì§ˆë¬¸ í‘œì‹œ
                document.getElementById('question-text').textContent = question.question;
                
                // ë‹µë³€ ì˜µì…˜ í‘œì‹œ
                const optionsContainer = document.getElementById('answer-options');
                optionsContainer.innerHTML = '';
                
                question.answers.forEach((answer, index) => {
                    const option = document.createElement('div');
                    option.className = 'quiz-option';
                    option.dataset.letter = answer.letter;
                    option.innerHTML = `
                        <span class="option-letter">${answer.letter.toUpperCase()})</span>
                        <span class="option-content">${answer.text}</span>
                    `;
                    optionsContainer.appendChild(option);
                });
                
                this.selectedAnswer = null;
                document.getElementById('matrix-input-text').textContent = '_';
                const nextBtn = document.getElementById('matrix-next-btn');
                nextBtn.disabled = true;
                nextBtn.classList.remove('show');
                
                // ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤ í•¸ë“¤ëŸ¬ê°€ ìˆìœ¼ë©´ ì§ˆë¬¸ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                if (window.smoothScrollHandler && typeof window.smoothScrollHandler.animateQuestionTransition === 'function') {
                    setTimeout(() => {
                        window.smoothScrollHandler.animateQuestionTransition();
                    }, 100);
                }
            }

            async showAnalyzing() {
                this.currentScreen = 'analyzing';
                document.getElementById('quiz-progress').style.display = 'none';
                document.getElementById('quiz-analyzing').style.display = 'block';
                
                // ë¶„ì„ ì§„í–‰ë¥  ì• ë‹ˆë©”ì´ì…˜
                const progressBar = document.getElementById('analysis-progress');
                const progressText = document.getElementById('analysis-text');
                
                for (let i = 0; i <= 100; i += 5) {
                    progressBar.style.width = `${i}%`;
                    progressText.textContent = `${i}%`;
                    await this.sleep(100);
                }
                
                // ê²°ê³¼ ê³„ì‚°
                const result = this.quizEngine.calculateResult();
                this.quizEngine.saveResult(result);
                
                // í€´ì¦ˆ ì™„ë£Œ - sessionStorage ì •ë¦¬ ë” ì´ìƒ ë¶ˆí•„ìš”
                
                // ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
                await this.sleep(1000);
                const shareUrl = this.quizEngine.generateShareUrl(result);
                window.location.href = `../result/?type=${result.type}&score=${result.maxScore}`;
            }

            showErrorScreen(message) {
                this.currentScreen = 'error';
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('quiz-start').style.display = 'none';
                document.getElementById('quiz-progress').style.display = 'none';
                document.getElementById('quiz-analyzing').style.display = 'none';
                document.getElementById('error-screen').style.display = 'block';
                document.getElementById('error-message').textContent = message;
            }

            setupEventListeners() {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°í•˜ì—¬ ì¤‘ë³µ ë°©ì§€
                this.removeEventListeners();
                
                // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
                this.keydownHandler = (e) => {
                    if (this.isProcessing) return;
                    
                    const key = e.key.toLowerCase();
                    
                    if (this.currentScreen === 'start') {
                        if (key === 'enter') {
                            this.startQuiz();
                        } else if (key === 'escape') {
                            window.location.href = '/';
                        }
                    } else if (this.currentScreen === 'quiz') {
                        if (['a', 'b', 'c', 'd', 'e'].includes(key)) {
                            this.selectAnswer(key);
                        } else if (key === 'enter' && this.selectedAnswer) {
                            this.submitAnswer();
                        } else if (key === 'escape') {
                            this.goBack();
                        }
                    } else if (this.currentScreen === 'error') {
                        if (key === 'r') {
                            location.reload();
                        } else if (key === 'h') {
                            window.location.href = '/';
                        }
                    }
                };
                
                // ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
                this.clickHandler = (e) => {
                    if (this.isProcessing) return;
                    
                    const option = e.target.closest('.quiz-option');
                    const nextBtn = e.target.closest('.matrix-next-button');
                    
                    if (option) {
                        const action = option.dataset.action;
                        const letter = option.dataset.letter;
                        
                        if (action === 'start') {
                            this.startQuiz();
                        } else if (action === 'back') {
                            window.location.href = '/';
                        } else if (action === 'retry') {
                            location.reload();
                        } else if (action === 'home') {
                            window.location.href = '/';
                        } else if (letter) {
                            this.selectAnswer(letter);
                        }
                    } else if (nextBtn && !nextBtn.disabled) {
                        this.submitAnswer();
                    }
                };
                
                document.addEventListener('keydown', this.keydownHandler);
                document.addEventListener('click', this.clickHandler);
            }
            
            removeEventListeners() {
                if (this.keydownHandler) {
                    document.removeEventListener('keydown', this.keydownHandler);
                }
                if (this.clickHandler) {
                    document.removeEventListener('click', this.clickHandler);
                }
            }

            async startQuiz() {
                if (this.isProcessing) return;
                this.isProcessing = true;
                
                document.getElementById('start-input').textContent = 'start';
                await this.sleep(500);
                document.getElementById('start-input').textContent = 'í€´ì¦ˆ ì‹œì‘ ì¤‘...';
                await this.sleep(1000);
                
                await this.showQuizScreen();
                this.isProcessing = false;
            }

            selectAnswer(letter) {
                if (this.isProcessing) return;
                
                // ê¸°ì¡´ ì„ íƒ í•´ì œ
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // ìƒˆë¡œìš´ ì„ íƒ
                const selectedOption = document.querySelector(`[data-letter="${letter}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                    this.selectedAnswer = letter;
                    document.getElementById('matrix-input-text').textContent = letter.toUpperCase() + ' _';
                    const nextBtn = document.getElementById('matrix-next-btn');
                    nextBtn.disabled = false;
                    nextBtn.style.removeProperty('display');
                    nextBtn.style.removeProperty('visibility');
                    nextBtn.style.removeProperty('opacity');
                    nextBtn.classList.add('show');
                    
                    // ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤
                    if (window.smoothScrollHandler && typeof window.smoothScrollHandler.scrollToNextButton === 'function') {
                        setTimeout(() => {
                            window.smoothScrollHandler.scrollToNextButton();
                        }, 100);
                    }
                }
            }

            async submitAnswer() {
                if (this.isProcessing || !this.selectedAnswer) return;
                this.isProcessing = true;
                
                try {
                    const result = this.quizEngine.submitAnswer(this.selectedAnswer);
                    
                    // ë‹µë³€ í™•ì¸ í‘œì‹œ
                    document.getElementById('matrix-input-text').textContent = 'ë‹µë³€ ì €ì¥ ì¤‘...';
                    const nextBtn = document.getElementById('matrix-next-btn');
                    nextBtn.disabled = true;
                    nextBtn.classList.remove('show');
                    await this.sleep(800);
                    
                    if (result.isComplete) {
                        await this.showAnalyzing();
                    } else {
                        await this.displayQuestion();
                    }
                } catch (error) {
                    console.error('Answer submission error:', error);
                    this.showErrorScreen('ë‹µë³€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
                this.isProcessing = false;
            }

            goBack() {
                if (this.quizEngine.currentQuestion > 0) {
                    this.quizEngine.goToPreviousQuestion();
                    this.displayQuestion();
                } else {
                    window.location.href = '/';
                }
            }

            // í€´ì¦ˆ ìƒíƒœ ë³µì› (ì–¸ì–´ í† ê¸€ ì‹œ)
            async restoreQuizState() {
                try {
                    const savedState = JSON.parse(sessionStorage.getItem('quizState'));
                    if (!savedState) {
                        await this.showStartScreen();
                        return;
                    }
                    
                    // í€´ì¦ˆ ì—”ì§„ ìƒíƒœ ë³µì›
                    this.quizEngine.currentQuestionIndex = savedState.currentQuestionIndex;
                    this.quizEngine.answers = savedState.answers || [];
                    this.quizEngine.isStarted = savedState.isStarted;
                    this.currentScreen = savedState.currentScreen;
                    this.selectedAnswer = savedState.selectedAnswer;
                    
                    // í™”ë©´ ìƒíƒœì— ë”°ë¼ ì ì ˆí•œ í™”ë©´ í‘œì‹œ
                    if (savedState.currentScreen === 'quiz') {
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('quiz-start').style.display = 'none';
                        document.getElementById('quiz-progress').style.display = 'block';
                        await this.displayQuestion();
                        this.setupEventListeners();
                    } else if (savedState.currentScreen === 'analyzing') {
                        await this.showAnalyzing();
                    } else {
                        await this.showStartScreen();
                    }
                    
                    // ì–¸ì–´ í† ê¸€ í”Œë˜ê·¸ ì œê±°
                    sessionStorage.removeItem('languageToggle');
                    
                } catch (error) {
                    console.error('State restoration error:', error);
                    await this.showStartScreen();
                }
            }

            async restoreFromUrl(questionIndex, answers) {
                try {
                    // ìƒíƒœ ë³µì›
                    this.quizEngine.currentQuestion = questionIndex;
                    this.quizEngine.answers = answers.filter(a => a !== '');
                    this.quizEngine.isStarted = true;
                    
                    // í€´ì¦ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
                    await this.showQuizScreen();
                    
                } catch (error) {
                    console.error('URL restoration error:', error);
                    await this.showStartScreen();
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
    </script>
</body>
</html>